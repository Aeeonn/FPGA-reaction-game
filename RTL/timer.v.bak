module timer(iCLK, start_btn, stop_btn, leds, oTIMER, state);
	input wire iCLK;
	input wire start_btn;
	input wire stop_btn;
	output reg [9:0] leds;
	output reg [13:0] oTIMER;
	
	reg [25:0] counter = 0;
	output reg [1:0] state = 0; // 0 = IDLE, 1 = WAIT_DELAY, 2 = TIMING
	reg delay_triggered = 0;
	
	wire [26:0] delay_value;
	wire done_delay;
	
	
	//Instantiate delay module
	lfsr_delay delay (
		.iCLK(iCLK), 
		.iRST(1'b0),
		.iEN(delay_triggered), 
		.oDONE(done_delay), 
		.oDELAY(delay_value)
	);
	
	
	always @(posedge iCLK) begin
		case (state)
			0: begin //IDLE
				delay_triggered <= 0;
				oTIMER <= 0;
				leds <= 10'b0001000000;
				counter <= 0;
				
				if (start_btn) 
				begin
					leds <= 10'b1111000000;
					delay_triggered <= 1;
					state <= 1;
				end
			end
				
			1: begin //WAITING FOR DELAY
				delay_triggered <= 0;
				if (done_delay)
				begin
					leds <= 10'b1111111111;
					state <= 2;
				end
				
				if (stop_btn)
				begin
					oTIMER <= 10_000 - 1;
					leds <= 10'b1010101010;
					state <= 3;
				end
			end
			
			
			2: begin //TIMING USER
				if (counter < 50_000 - 1) 
				begin
					counter <= counter + 1;
				end else begin
					counter <= 0;
					oTIMER <= oTIMER + 1;
				end
				
				if (stop_btn || oTIMER == 14'd10_000 - 1) 
				begin
					state <= 3;
					leds <= 10'b0000000000;
				end
			end
			
			3: begin //SHOW
				if (start_btn)
					state <= 0;
			end
			
			default: state <= 0;
			
		endcase
	end
	
endmodule